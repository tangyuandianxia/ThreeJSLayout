<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <style>
        body {
            font-family: Monospace;
            background-color: #000;
            /*background-color: #969696;*/
            /*background-color: #fff;*/
            color: #fff;
            /*margin: 0px;*/
            /*overflow: hidden;*/
            margin: 0 0 0 0;
            padding: 0 0 0 0;
            border: none;
            cursor: default;
        }
        #info {
            color: #fff;
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display:block;
        }
        #info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }

        #glFullscreen {
            width: 100%;
            height: 100vh;
            min-width: 640px;
            min-height: 360px;
            position: relative;
            overflow: hidden;
            z-index: 0;
        }
        #example {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: #000000;
            z-index: 0;
        }

        /*设置区域的style属性*/
        .setStyle{
            color:red;
        }

        .dg.ac {
            z-index: 1 !important; /* FIX DAT.GUI */
        }
    </style>
    <style>
        /*.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1!important}.dg.main .close-button.drag,.dg.main:hover .close-button{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;transition:opacity .1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save>ul{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height .1s ease-out;transition:height .1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.boolean,.dg .cr.boolean *,.dg .cr.function,.dg .cr.function *,.dg .cr.function .property-name{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco,monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px Lucida Grande,sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid hsla(0,0%,100%,.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.boolean:hover,.dg .cr.function:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}*/
    </style>
    <script src="../three.js-master/examples/js/libs/dat.gui.min.js"></script>
</head>
<body>
<!--<script type="text/javascript" src="../learning-threejs-master/libs/three.js"></script>
<script type="text/javascript" src="../learning-threejs-master/libs/OBJLoader.js"></script>
<script type="text/javascript" src="../learning-threejs-master/libs/MTLLoader.js"></script>
<script type="text/javascript" src="../learning-threejs-master/libs/OBJMTLLoader.js"></script>-->


<script src="../three.js-master/build/three.js"></script>
<script src="../three.js-master/examples/js/loaders/OBJLoader.js"></script>
<script src="../three.js-master/examples/js/loaders/MTLLoader.js"></script>

<script src="../three.js-master/examples/js/controls/TrackballControls.js"></script>
<script src="../three.js-master/examples/js/controls/OrbitControls.js"></script>


<script src="../three.js-master/examples/js/shaders/CopyShader.js"></script>
<script src="../three.js-master/examples/js/shaders/FXAAShader.js"></script>
<script src="../three.js-master/examples/js/postprocessing/EffectComposer.js"></script>
<script src="../three.js-master/examples/js/postprocessing/RenderPass.js"></script>

<script src="../three.js-master/examples/js/postprocessing/ShaderPass.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/shaders/CopyShader.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/shaders/ColorifyShader.js"></script>

<script src="../three.js-master/examples/js/postprocessing/OutlinePass.js"></script>

<script type="text/javascript" src="../three.js-master/examples/js/postprocessing/BloomPass.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/shaders/ConvolutionShader.js"></script>

<script type="text/javascript" src="../three.js-master/examples/js/postprocessing/MaskPass.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/postprocessing/FilmPass.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/shaders/FilmShader.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/shaders/SepiaShader.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/postprocessing/SavePass.js"></script>
<script type="text/javascript" src="../three.js-master/examples/js/postprocessing/TexturePass.js"></script>

<!--<div id="info">
    <a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - OBJLoader2 direct loader test
    <input value="test">
    <div id="feedback"></div>
</div>-->
<!--<div class="dg ac">
    <div class="dg main a" style="width: 300px;">
        <ul>
            <li class="cr number has-slider">
                <div>
                    <div class="c">
                        <div>
                            <input type="text">
                        </div>
                    </div>
                </div>
            </li>
        </ul>

    </div>
</div>-->

<div style="position:absolute;left: 150px;top: 20px;height: 45px;width: 230px;z-index:300;">
    <font id="mtao_name" class="setStyle">机床名:</font>
    <input type="text" value="" id="matoname" style="width: 150px;z-index:800;">
</div>
<div style="position:absolute;left: 370px;top: 17px;height: 45px;width: 450px;z-index:200">
    <table>
        <tr>
            <td>
                <font class="setStyle">X ：</font>
            </td>
            <td>
                <input type="text" value="0" id="X" style="width: 45px;">

            </td>
            <td>
                <font class="setStyle">Y ：</font>
            </td>
            <td>
                <input type="text" value="0" id="Y" style="width: 45px"/>

            </td>
            <td>
                <font class="setStyle">Z ：</font>
            </td>
            <td>
                <input type="text" value="0" id="Z" style="width: 45px"/>

            </td>
            <td>
                <font class="setStyle">宽：</font>
            </td>
            <td>
                <input type="text" id="W" style="width: 45px">

            </td>
            <td>
                <font class="setStyle">高：</font>
            </td>
            <td>
                <input type="text" id="H" style="width: 45px">
            </td>
        </tr>
    </table>

</div>
<div style="position:absolute;left: 800px;top:17px;width: 120px;z-index:200;">
    <font class="setStyle">应用于所有机床:</font><input type="checkbox" id="checkAll">
</div>
<button type="button" class="btn btn-default" onclick="image_change_save()" name="保存修改"
        style="position:absolute;left:930px;top: 17px;z-index:200;">
    保存修改
</button>
<button type="button" class="btn btn-default" onclick="add_machine()" name="添加设备"
        style="position:absolute;left:1030px;top: 17px;z-index:200;">
    添加设备
</button>
<div id="glFullscreen">
    <canvas id="example"></canvas>

</div>
<script type="text/javascript">
    var container, stats;
    var camera, scene, renderer;

    var  meshObj = null;

    //测试
    var composer, effectFXAA, outlinePass;
    var obj3d = new THREE.Object3D();

    var group = new THREE.Group();

    var raycaster = new THREE.Raycaster();

    var mouse = new THREE.Vector2();
    var selectedObjects = [];

    var OBJFlag = true;

    var clock;
    var controls;
    var raycaster = null;
    var mouse = new THREE.Vector2(), INTERSECTED;

    var countNum = 0;
    id = setInterval(getJson, 5000);//每隔20s重绘一次


    var params = {
        edgeStrength: 3.0,
        edgeGlow: 0.0,
        edgeThickness: 1.0,
        pulsePeriod: 0,
        rotate: false,
        usePatternTexture: false
    };
    var paramsControls = new function (){
        this.x = 0;
        this.y = 0;
        this.z = 0;
    }
    var gui = new dat.GUI( { width: 300 } );
    gui.add( params, 'rotate' );
//    gui.add( paramsControls, 'zuobiao', -1000, 1000 );

    init();
//    animate();
    function init() {
        /*container = document.createElement( 'div' );
        document.body.appendChild( container );

        var width = window.innerWidth;
        var height = window.innerHeight;

        renderer = new THREE.WebGLRenderer();
        renderer.shadowMap.enabled = true;
        renderer.antialias = true;
        // todo - support pixelRatio in this demo
        renderer.setSize( width, height );
        document.body.appendChild( renderer.domElement );*/

        renderer = new THREE.WebGLRenderer({//渲染器
            canvas: document.getElementById('example')//画布
            ,
            alpha: true,//设置场景透明
            antialias:true,//抗锯齿
        });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        var width = window.innerWidth;
        var height = window.innerHeight;

        scene = new THREE.Scene();//创建场景

        //            网格宽度、等分数、中心线颜色，网格线颜色
        var helper = new THREE.GridHelper(1200, 60, 0xFF4444, 0x404040);
        scene.add(helper);

        //在场景中添加坐标轴
        //X轴红色，Y轴绿色，Z轴蓝色。
        var axes = new THREE.AxesHelper(2000);
        scene.add(axes);

        camera = new THREE.PerspectiveCamera( 30, 1, 0.1, 10000 );//透视摄影机
        camera.position.set(1300.0, 600.0, 1200.0);//相机位置
        camera.aspect = width / height;
//            camera.position.set(-0.0, 0.0, 0.0);//相机位置
//            camera.lookAt(new THREE.Vector3(0, 0, 0));//lookAt()设置相机所看的位置
            camera.lookAt(new THREE.Vector3(0, 0, 0));//lookAt()设置相机所看的位置
//        camera.lookAt(scene.position);//lookAt()设置相机所看的位置
        camera.updateProjectionMatrix(); //调用updateProjectionMatrix方法,更新相机的投影矩阵.


        scene.add(camera);//把相机添加到场景中

        //环境光
//        var ambientLight = new THREE.AmbientLight( 0x404040 );
        var ambientLight = new THREE.AmbientLight( 'white' );
        //方向光
        var directionalLight1 = new THREE.DirectionalLight( 0xC0C090 );
        var directionalLight2 = new THREE.DirectionalLight( 0xC0C090 );
//            var ambientLight = new THREE.AmbientLight( 'white' );
//            var directionalLight1 = new THREE.DirectionalLight( 'white' );
//            var directionalLight2 = new THREE.DirectionalLight( 'white' );
        directionalLight1.position.set( -100, -50, 100 );
        directionalLight2.position.set( 100, 50, -100 );
        scene.add(directionalLight1);
        scene.add(directionalLight2);
        scene.add(ambientLight);


////监听鼠标、键盘事件，旋转图形
        controls = new THREE.OrbitControls(camera);
//        controls = new THREE.TrackballControls( camera, renderer.domElement );


        controls.autoRotate = false;
        //使用 掩膜需要的
        clock = new THREE.Clock();

        /*var material = new THREE.MeshPhongMaterial({
//            color: 'green',
            wireframe:false,
            map: new THREE.TextureLoader().load('images/xian1.jpg'),
        })
        box = new THREE.Mesh(new THREE.BoxBufferGeometry(100,100,100,10,10,10),material);
        scene.add(box);*/

        /***
         * 加载obj
         * @type {THREE.OBJLoader}
         */
        var  texture = new THREE.TextureLoader().load('images/xian1.jpg');
        texture.wrapS = THREE.RepeatWrapping;
        texture.wrapT = THREE.RepeatWrapping;

        var path = 'obj/skjc/';
        loadMTLOBJ(path,'shukongjichuang',path,'shukongjichuang','shukongjichuang',0,100,0);
        loadMTLOBJ(path,'shukongjichuang2',path,'shukongjichuang2','shukongjichuang2',300,100,200);
        loadMTLOBJ(path,'kaijuanji',path,'kaijuanji','kaijuanji',-300,110,200);

        //TODO  后期处理测试中
//        window.addEventListener( 'touchmove', onTouchMove );

        function onTouchMove( event ) {

            var x, y;

            if ( event.changedTouches ) {

                x = event.changedTouches[ 0 ].pageX;
                y = event.changedTouches[ 0 ].pageY;

            } else {

                x = event.clientX;
                y = event.clientY;

            }

            mouse.x = ( x / window.innerWidth ) * 2 - 1;
            mouse.y = - ( y / window.innerHeight ) * 2 + 1;

        }

        //捕获模型
        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();
//            var mouse = new THREE.Vector2(), INTERSECTED;
//            document.addEventListener( 'mousemove', onDocumentMouseMove, false );
//            document.addEventListener( 'mousemove', onMouseMove, false );
//            id = setInterval(draw, 20);//每隔20s重绘一次
        createText('这是进行过测试的文字ThreeJS',300,100,200);

        createText_another();
        //TODO 测试
        //自适应
        window.addEventListener( 'resize', onWindowResize, false );

        window.addEventListener( 'click', onMouseClick, false );

        //TODO 双击事件测试
        window.addEventListener( 'dblclick', onMouseDBClick, false );

        render();

    }
    var onProgress = function(xhr) {
        if (xhr.lengthComputable) {
            var percentComplete = xhr.loaded / xhr.total * 100;
            var percent = document.getElementById("percent");
//                    percent.innerText = Math.round(percentComplete, 2) + '% 已经加载';
        }

       console.log("onProgress 方法执行完毕");
    };
    var onError = function(xhr) {};
    //自适应
    function onWindowResize() {
        var width = window.innerWidth;
        var height = window.innerHeight;
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize( width, height );
    }
    function onMouseClick( event ) {
        //通过鼠标点击的位置计算出raycaster所需要的点的位置，以屏幕中心为原点，值的范围为-1到1.
        mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        // 通过鼠标点的位置和当前相机的矩阵计算出raycaster
        raycaster.setFromCamera( mouse, camera );

        // 获取raycaster直线和所有模型相交的数组集合
        var intersects = raycaster.intersectObjects( scene.children,true );
        if(intersects.length >0){
            //第一个符合条件的物体
            var getObj = intersects[0].object.parent;
            if(getObj instanceof THREE.Group){
                document.getElementById('X').value = getObj.position.x;
                document.getElementById('Y').value = getObj.position.y;
                document.getElementById('Z').value = getObj.position.z;

                document.getElementById('matoname').value = getObj.name;
            }
//            intersects[0].object.material[0].color.set( 'red' );
//            intersects[0].object.material[0].color.set( 'green' );

            /*intersects[0].object.traverse( function ( child ) {
                if (child instanceof THREE.Mesh) {
                    child.material.needsUpdate = true;
                    for(var i=0;i<child.material.length;i++){
                        child.material[i].color.set( 'green' );
                    }
                }
            });*/
            changeColor(intersects[0].object,'red');
//            intersects[0].object.material[0].color.set( 'orange' );
//            intersects[0].object.material[0].emissive.set( 'red' )
        }
    }
    function onMouseDBClick( event ) {
        //通过鼠标点击的位置计算出raycaster所需要的点的位置，以屏幕中心为原点，值的范围为-1到1.
        mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        // 通过鼠标点的位置和当前相机的矩阵计算出raycaster
        raycaster.setFromCamera( mouse, camera );
        // 获取raycaster直线和所有模型相交的数组集合
        var intersects = raycaster.intersectObjects( scene.children,true );
        if(intersects.length >0){
            //第一个符合条件的物体
            var getObj = intersects[0].object.parent;
            if(getObj instanceof THREE.Group){
                document.getElementById('X').value = getObj.position.x;
                document.getElementById('Y').value = getObj.position.y;
                document.getElementById('Z').value = getObj.position.z;

                document.getElementById('matoname').value = getObj.name;
            }
//            intersects[0].object.material[0].color.set( 'green' );
//            intersects[0].object.material[0].color.setRGB(0.5887,0.5887,0.5887);
            /*intersects[0].object.traverse( function ( child ) {
                if (child instanceof THREE.Mesh) {
                    child.material.needsUpdate = true;
                    for(var i=0;i<child.material.length;i++){
                        child.material[i].color.setRGB(0.5887,0.5887,0.5887);
                    }
                }
            });*/
            resetColor(intersects[0].object);
//            intersects[0].object.material[0].emissive.set( 'red' );
        }
    }
    function animate() {
        requestAnimationFrame( animate );
        render();

    }

    function render(){4
        var  texture = new THREE.TextureLoader().load('images/caodi.jpg');
//        texture.wrapS = THREE.RepeatWrapping;
//        texture.wrapT = THREE.RepeatWrapping;


        scene.traverse( function ( child ) {
            if ( child instanceof THREE.Group ) {
            }
        } );

        /*renderer.autoClear = false;
        var delta = clock.getDelta();
        controls.update(delta);*/

        renderer.render(scene, camera);//调用WebGLRenderer的render函数刷新场景
        requestAnimationFrame(render);
//        composer.render(delta);


    }

    function loadMTLOBJ(mtlPath,mtl,objPath,obj,objName,X,Y,Z){
        var mtlLoader = new THREE.MTLLoader();
//        mtlLoader.setPath('obj/skjc/');
        mtlLoader.setPath(mtlPath);
        mtlLoader.load(mtl+'.mtl', function (materials) {
            materials.preload();//预加载

            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
//            objLoader.setPath('obj/skjc/');
            objLoader.setPath(objPath);
            objLoader.load(obj+'.obj', function (object) {
                        object.rotation.y = 0;
                        object.position.x = X;
                        object.position.y = Y;
                        object.position.z = Z;
//            object.scale.set(0.1, 0.1, 0.1);//缩放
//                        object.name = 'kaijuanji';
                        object.name = objName;
                        meshObj = object;

                        /*var boxhelper=new THREE.BoxHelper(object);
                        scene.add(boxhelper);*/
                        //放入场景
                        scene.add(object);

                    },
                    onProgress, onError);
        });
    }

    function getJson(){
        countNum ++ ;

//            scene.getObjectById ( id );
        /**
         * 根据name 获取obj模型
         * @type {any}
         */
        var obj = scene.getObjectByName ( 'kaijuanji' );
        if(countNum % 2 ==0){
//            obj.children[0].material[0].color.setRGB(0.5887,0.5887,0.5887);
            resetColor(obj);
        }else{
//            obj.children[0].material[0].color.set( 'red' );
            changeColor(obj,'red');
        }
    }
    /**
     *
     * 生成文字
     * 方法2
     */
    function createText_another(){
        var loader = new THREE.FontLoader();
        //加载字体库，加载成功后将字体库传给回调函数；
        loader.load('fonts/Microsoft YaHei_Regular.json',function(response) {
            var font = response;
            /*创建字体几何图形，其中TextGeometry的第一个参数是需要绘制的文本，第二个参数是一个json对象，设置如何绘制文本，具体意义为：
             font: 使用的字体库；
             size:绘制字体的大小；
             height:绘制文本的厚度；
             bevelEnabled：是否允许棱角平滑过渡；
             bevelSize:棱角平滑过渡的尺寸；*/
            //注意:bevelSize通常要比size和height小一个量级，过渡带就会很饱满甚至比文本主体本身还要大


            var textGeometry = new THREE.TextGeometry("学习Three.js", {
                "font": font,
                "size": 70,
                "height": 20,
                "bevelEnabled": true,
                "bevelSize": 2
            })

            /*在3D世界里所有的物体都是由网格构成的，在three.js中，绘制图形的步骤是：
             先使用geometry定义图形的几何形状，然后使用几何形状和材质构建网格;*/

            /*这里使用材质数组来对网格进行修饰，材质数组的第一项修饰文字正面和背面，
             第二项修饰文字的侧面即顶部和底部。使用的两个材质都是MeshPhongMaterial,这种材质的特点是能够像塑料一样反光。*/
            text = new THREE.Mesh(textGeometry, new THREE.MultiMaterial([
                new THREE.MeshPhongMaterial({color: 0xffffff, shading: THREE.FlatShading}),
                new THREE.MeshPhongMaterial({color: 0xffffff, shading: THREE.SmoothShading})
            ]))
            textGeometry.computeBoundingBox();

            var centerOffset = -0.5 * (textGeometry.boundingBox.max.x-textGeometry.boundingBox.min.x);
            text.position.x = centerOffset;
            text.position.y = 30;

            scene.add(text);
            var plane = new THREE.Mesh(
                    new THREE.PlaneBufferGeometry( 10000, 10000 ),
                    new THREE.MeshBasicMaterial( { color: 0xfffffff, opacity: 0.5, transparent: true } )
            );
            plane.rotation.x = -Math.PI/2;
            plane.position.y = 0;
//            scene.add(plane);

            });

        }

    /**
     * 生成文字
     * @param msg  文字
     * @param x
     * @param y
     * @param z
     */
    function  createText(msg,x,y,z){
        //引入文字
        var loader = new THREE.FontLoader();
//        loader.load( '../three.js-master/examples/fonts/helvetiker_regular.typeface.json', function ( font ) {
//        loader.load( '../three.js-master/examples/fonts/optimer_regular.typeface.json', function ( font ) {
        loader.load( 'fonts/Microsoft YaHei_Regular.json', function ( font ) {
//        loader.load( '../three.js-master/examples/fonts/gentilis_regular.typeface.json', function ( font ) {
//        loader.load( '../three.js-master/examples/fonts/gentilis_bold.typeface.json', function ( font ) {

            var xMid, text;

            var textShape = new THREE.BufferGeometry();

//                var color = 0x006699;
            var color = 'yellow';

            var matDark = new THREE.LineBasicMaterial( {
                color: color,
                side: THREE.DoubleSide
            } );

            var matLite = new THREE.MeshBasicMaterial( {
//                wireframe:true,
//                wireframeLinewidth:20,
                color: color,
                transparent: true,
//                opacity: 0.4,//透明度
                side: THREE.DoubleSide
            } );

//                var message = "   Three.js\nSimple text.";
            var message = msg;

            //控制字体大小和内容
            var shapes = font.generateShapes( message, 20 );

            var geometry = new THREE.ShapeGeometry( shapes );

            geometry.computeBoundingBox();

//                xMid = - 0.5 * ( geometry.boundingBox.max.x - geometry.boundingBox.min.x );
            xMid = - 1.0 * ( geometry.boundingBox.max.x - geometry.boundingBox.min.x );

            geometry.translate( xMid, 100, 0 );

            // make shape ( N.B. edge view not visible )

            textShape.fromGeometry( geometry );

            text = new THREE.Mesh( textShape, matLite );
            /*text.position.x = x;
            text.position.y = y;
            text.position.z = z;*/
            text.position.set( x, y, z );
//            textMesh.position.set( 50, 100, 50 );
//            textMesh.rotation.x = -Math.PI / 4;
            text.name = "texTest";
            scene.add( text );

        } ); //end load function
    }
    /**
     * 改变颜色
     * @param obj
     * @param color
     */
    function changeColor(obj,color) {
        obj.traverse( function ( child ) {
            if (child instanceof THREE.Mesh) {
                child.material.needsUpdate = true;
                for(var i=0;i<child.material.length;i++){
//                    child.material[i].color.set( 'red' );
                    child.material[i].color.set( color );
                }
            }
        });
    }
    /**
     * 重置颜色
     * @param obj
     */
    //TODO 如果有不同的模型，需要测试方法是否需要改变
    function resetColor(obj) {
        obj.traverse( function ( child ) {
            if (child instanceof THREE.Mesh) {
                child.material.needsUpdate = true;
                for(var i=0;i<child.material.length;i++){
                    child.material[i].color.setRGB(0.5887,0.5887,0.5887);
                }
            }
        });
    }
    //TODO 测试 点击事件
    function image_change_save(){
        //获取选中的设备
        var matoname = document.getElementById('matoname').value;
        var obj = scene.getObjectByName (matoname);
        obj.position.x = document.getElementById('X').value;
        obj.position.y = document.getElementById('Y').value;
        obj.position.z = document.getElementById('Z').value;
    }
    function add_machine(){
        var path = 'obj/skjc/';
        loadMTLOBJ(path,'shukongjichuang2',path,'shukongjichuang2','shukongjichuang2',500,100,200);
    }
</script>
</body>
</html>